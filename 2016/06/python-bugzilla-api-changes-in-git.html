<!DOCTYPE html>
<html>
    <head>
        <title>python-bugzilla API changes in git - Cole Robinson</title>
        <meta charset="utf-8" />
        <link href="https://crobinso.github.io/theme/minima-main.css" rel="stylesheet" />
        <link href="https://crobinso.github.io/theme/coletheme.css" rel="stylesheet" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href="https://crobinso.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Cole Robinson Full Atom Feed" />
    </head>

    <body id="index" class="archive">
        <div class="wrapper">
            <header class="site-header" role="banner">
                <a class="site-title" href="https://crobinso.github.io">Cole Robinson</a>
                <nav class="site-nav">
                <div class="trigger">
                    <a class="page-link" href="https://crobinso.github.io">Home</a>
                    <a class="page-link" href="https://crobinso.github.io/archives.html">Archives</a>
                <!-- -->
                </div></nav>
             </header>
<main id="content" class="page-content">

  <header>
    <h2 class="post-title">python-bugzilla API changes in git</h2>
    <p class="post-meta">
      <time class="dt-published" datetime="2016-06-07T20:06:00-04:00" itemprop="datePublished">Tue 07 June 2016
      </time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Cole Robinson</span>
      </span> • </a> Tags: <a href="https://crobinso.github.io/tag/fedora.html">fedora </a>    </p>
  </header>

  <div class="post-content">
    <p>I've made a number of API changes to python-bugzilla in git. Most of it is removing old mis-designed features which I don't think anyone is actually using. I went through all apps I know of that use python-bugzilla (fedora bits like bodhi pkgdb infra scripts, bugwarrior, searchcode.com) to confirm as much and I don't think anything below will affect them. Even if there's no complaints I won't cut the release for 4-6 weeks.</p>
<p>The list is long but most changes are fairly straight forward. If any of this sounds controversial, or if I misjudged one of the 'unused' bits and should reconsider, please leave your thoughts here or on the python-bugzilla mailing list.</p>
<p>The interesting change is:</p>
<ul>
<li>Bugzilla.bug_autorefresh now defaults to False. Previously if trying to access Bug.foo, and 'foo' wasn't cached, the Bug() object would basically do a Bug.refresh() and fetch all the bug contents from the server. This default sucks, it can lead to poorly performing scripts and unnecessary bugzilla load. If you have code that uses include_fields, exclude_fields, or extra_fields anywhere, this change may affect you. You can set Bugzilla().bug_autorefresh = False before doing any bug lookup to force this off (with current versions) and catch any errors. If you hit issues you probably need to extend your include_fields specifications. The reason for this change is that the old pattern made it too easy for people's scripts to unintentionally start requiring a much higher number of XMLRPC calls, thus completely negating the usage of include_fields in the first place. Some more details over here: <a href="https://github.com/python-bugzilla/python-bugzilla/blob/master/examples/bug_autorefresh.py">https://github.com/python-bugzilla/python-bugzilla/blob/master/examples/bug_autorefresh.py</a> <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1297637">https://bugzilla.redhat.com/show_bug.cgi?id=1297637</a></li>
</ul>
<p>These are slightly interesting and may impact a few people:</p>
<ul>
<li>Credentials are now cached in ~/.cache/python-bugzilla/. If the old ~/.bugzilla{cookies,token} files are in place we will continue to update and use them. * RHBugzilla.rhbz_back_compat __init__ attribute is gone. If the user manually set this to true, we would alter some Bug fields returned via query() to convert python lists into a single comma separated string, to match rhbugzilla output from before the 2012 upgrade. Convert your code to use the modern bugzilla list output.</li>
<li>bin/bugzilla was converted to argparse, which has a bug on python 2.7 that affects some possible command lines: http://bugs.python.org/issue9334 If you use a command like 'bugzilla modify --cc -foo@example.com' to remove that email from the CC list, you now need to ensure there's an equals sign in there, like --cc=-foo@example.com. That is backwards compatible with old python-bugzilla too, so update your scripts now. A few other options expect that format too.</li>
<li>bugzilla query --boolean_chart option is removed. It provided a custom specification for crafting complex queries, similar to what the bugzilla UI can do. I don't think anyone is really using this, but if you are, generate a web query URL and pass it to bugzilla query --from-url '$URL' which is much easier to deal with.</li>
<li>bugzilla query 'boolean' options, where you could say 'bugzilla query --keywords 'foo &amp; bar' to match both substrings, are no longer supported. If you need logic like this, use the --from-url technique mentioned above.</li>
<li>Bug.get_history() is now Bug.get_history_raw() Bugzilla.bugs_history is now Bugzilla.bugs_history_raw() This API is only a year old and unwisely returns raw output from bugzilla, which has some formatting oddities. I renamed it to *_raw so we have the future opportunity to add an API with better output.</li>
<li>The getbugsimple and getbugssimple APIs were removed. They were basically just wrappers around standard getbug() at this point. Use getbug/getbugs instead.</li>
<li>The simplequery API was removed. This basically matches the basic query from the bugzilla front page. Just use the standard query methods instead, see examples/query.py from git. I didn't find any users of this function.</li>
<li>Various whiteboard editing functions from the Bug object were removed. - getwhiteboard: this is just a wrapper around standard Bug attributes - appendwhiteboard, prependwhiteboard, setwhiteboard: these were just wrappers around standard build_update/update_bugs - addtag/gettags/deltag which minor wrappers around the *whiteboard functions, and were poorly named, given that there's an actual bug 'tags' field at this point. See <a href="https://github.com/python-bugzilla/python-bugzilla/blob/master/examples/update.py">examples/update.py</a> from git for examples of using the standard update APIs. That said I've never heard of anyone actually using these, and they were designed around really old RHBZ APIs.</li>
</ul>
<p>These I doubt will actually affect anyone:</p>
<ul>
<li>Bugzilla.initcookie() dropped... use Bugzilla.cookiefile = X instead </li>
<li>Bugzilla.adduser() dropped... it was the same as Bugzilla.createuser </li>
<li>RHBugzilla.multicall __init__ attribute is gone. It's been a no-op and raises a warning for a long time. </li>
<li>Bugzilla.version string is gone... this was meant to describe the python-bugzilla API version but was never used. </li>
<li>Initing like Bugzilla() with no options was previously allowed, but now requires an explicit Bugzilla(url=None). </li>
<li>We no longer handle cookies in LWP format. We've been silently converting them to mozilla format for 2 years so I assume this doesn't affect anyone, but if it does, you might need to delete your caches in ~/.bugzilla{cookies,token} </li>
<li>Bug.setstatus(), Bug.close() args 'private_in_it' and 'nomail' were removed: they have been no-ops for years </li>
<li>Bug.addcomment() args 'timestamp', 'bz_gid' and 'worktime' were removed: they've been no-ops for years</li>
<li>Bug.setassignee() arg 'reporter' was removed: it's thrown an error for years</li>
</ul>
  </div>

</main>


<footer class="site-footer h-card">
  <div class="wrapper">
    <h2 class="footer-heading">Cole's dev log</h2>
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
            <li class="p-name">Cole Robinson </li><li><a class="u-email" href="mailto:">aintdiscole@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/crobinso"><svg class="svg-icon"><use xlink:href="https://crobinso.github.io/theme/minima-social-icons.svg#github"></use></svg> <span class="username">crobinso</span></a></li><li><a href="https://www.twitter.com/aintdiscole"><svg class="svg-icon"><use xlink:href="https://crobinso.github.io/theme/minima-social-icons.svg#twitter"></use></svg> <span class="username">aintdiscole</span></a></li><li><a href="https://www.linkedin.com/in/cole-robinson-484a9912"><svg class="svg-icon"><use xlink:href="https://crobinso.github.io/theme/minima-social-icons.svg#linkedin"></use></svg> <span class="username">Cole Robinson</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3" align="center">
        <a href="https://crobinso.github.io/feeds/all.atom.xml">RSS</a>
      </div>
    </div>

  </div>
</footer>
        </div><!-- container -->
    </body>
</html>