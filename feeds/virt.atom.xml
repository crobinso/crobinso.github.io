<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Cole's dev log - virt</title><link href="https://crobinso.github.io/" rel="alternate"></link><link href="https://crobinso.github.io/feeds/virt.atom.xml" rel="self"></link><id>https://crobinso.github.io/</id><updated>2019-04-09T14:01:00-04:00</updated><entry><title>Host 'Network Interfaces' panel removed from virt-manager</title><link href="https://crobinso.github.io/2019/04/host-network-interfaces-panel-removed.html" rel="alternate"></link><published>2019-04-09T14:01:00-04:00</published><updated>2019-04-09T14:01:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2019-04-09:/2019/04/host-network-interfaces-panel-removed.html</id><summary type="html">&lt;p&gt;I released &lt;a href="https://www.redhat.com/archives/virt-tools-list/2018-October/msg00087.html"&gt;virt-manager 2.0.0&lt;/a&gt; in October 2018. Since the release contained the full port to python3, it seemed like a good opportunity to drop some baggage from the app.&lt;/p&gt;
&lt;p&gt;The biggest piece we removed was the UI for managing host network interfaces. This is the Connection Details-&gt;Network …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I released &lt;a href="https://www.redhat.com/archives/virt-tools-list/2018-October/msg00087.html"&gt;virt-manager 2.0.0&lt;/a&gt; in October 2018. Since the release contained the full port to python3, it seemed like a good opportunity to drop some baggage from the app.&lt;/p&gt;
&lt;p&gt;The biggest piece we removed was the UI for managing host network interfaces. This is the Connection Details-&gt;Network Interfaces panel, and the 'New Interface' wizard for defining host network definitions for things like bridges, bonds, and vlan devices. The main screen of the old UI looked like this:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://2.bp.blogspot.com/-z9wAKvWEkck/XKvexfuWBqI/AAAAAAAAC5w/4j3bap-0-7cQxeMQ9bhQl5a-969EK4kpACLcBGAs/s1600/Screenshot%2Bfrom%2B2019-04-08%2B19-47-21.png"&gt;&lt;img alt="" height="280" src="https://2.bp.blogspot.com/-z9wAKvWEkck/XKvexfuWBqI/AAAAAAAAC5w/4j3bap-0-7cQxeMQ9bhQl5a-969EK4kpACLcBGAs/s400/Screenshot%2Bfrom%2B2019-04-08%2B19-47-21.png" width="400"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Behind the scenes, this UI was using libvirt's Interface APIs, which also power the 'virsh iface-*' commands. These APIs are little more than a wrapper around the &lt;a href="https://pagure.io/netcf"&gt;netcf&lt;/a&gt; library.&lt;/p&gt;
&lt;p&gt;netcf aimed to be a linux distro independent API for network device configuration. On Red Hat distros this meant turning the API's XML format into an /etc/sysconfig/network script. There were even pie-in-the-sky ideas about NetworkManager one day using netcf.&lt;/p&gt;
&lt;p&gt;In practice though the library never really took off. It was years before a debian backend showed up, contributed by a Red Hatter in the hope of increasing library uptake, though it didn't seem to help. netcf basically only existed to serve the libvirt Interface APIs, yet those APIs were never really used by any major libvirt consuming app, besides virt-manager. And in virt-manager's case it was largely just slapping some UI over the XML format and lifecycle operations.&lt;/p&gt;
&lt;p&gt;For virt-manager's usecases we hoped that netcf would make it trivial to bridge the host's network interface, which when used with VMs would give them first class IP addresses on the host network setup, not NAT like the 'default' virtual network. Unfortunately though the UI would create the ifcfg files well enough, behind the scenes nothing played well with NetworkManager for years and years. The standard suggestion for was to disable NetworkManager if you wanted to bridge your host NIC. Not very user friendly. Some people did manage to use the UI to that effect but it was never a trivial process.&lt;/p&gt;
&lt;p&gt;Nowadays NetworkManager can handle bridging natively and is much more powerful than what virt-manager/libvirt/netcf provide. The virt-manager UI was more likely to shoot you in the foot than make things simple. And it had become increasingly clear that virt-manager was not the place to maintain host network config UI.&lt;/p&gt;
&lt;p&gt;So we made the decision to drop all this from virt-manager in 2.0.0. netcf and the libvirt interface APIs still exist. If you're interested in some more history on the interface API/netcf difficulties, check out &lt;a href="https://www.redhat.com/archives/virt-tools-list/2018-October/msg00049.html"&gt;Laine's email&lt;/a&gt; to virt-tools-list.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Setting custom network names on Fedora</title><link href="https://crobinso.github.io/2018/10/setting-custom-network-names-on-fedora.html" rel="alternate"></link><published>2018-10-04T21:27:00-04:00</published><updated>2018-10-04T21:27:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2018-10-04:/2018/10/setting-custom-network-names-on-fedora.html</id><summary type="html">&lt;p&gt;&lt;a href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/"&gt;systemd predictable network names&lt;/a&gt; give us host interface names like &lt;strong&gt;enp3s0&lt;/strong&gt;. On one of my hosts, I have two interfaces: one that is my regular hard wired connection, and another I only plug in occasionally for some virt network testing. I can never remember the systemd names, so I want …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/"&gt;systemd predictable network names&lt;/a&gt; give us host interface names like &lt;strong&gt;enp3s0&lt;/strong&gt;. On one of my hosts, I have two interfaces: one that is my regular hard wired connection, and another I only plug in occasionally for some virt network testing. I can never remember the systemd names, so I want to rename the interfaces to something more descriptive for my needs. in my case &lt;strong&gt;lan0main&lt;/strong&gt; and &lt;strong&gt;lan1pcie&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The page referenced says to use systemd links. However after struggling with that for a while I'm that's only relevant to systemd-networkd usage and doesn't apply to Fedora's default use of NetworkManager. So I needed another way.&lt;/p&gt;
&lt;p&gt;Long story short I ended up with some custom udev rules that are patterned after the old 70-persistent-net.rules file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat /etc/udev/rules.d/99-cole-nic-names.rules
&lt;span class="go"&gt;SUBSYSTEM==&amp;quot;net&amp;quot;, ACTION==&amp;quot;add&amp;quot;, DRIVERS==&amp;quot;?*&amp;quot;, ATTR{address}==&amp;quot;70:8b:cd:80:e5:5f&amp;quot;, ATTR{type}==&amp;quot;1&amp;quot;, NAME=&amp;quot;lan0main&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;SUBSYSTEM==&amp;quot;net&amp;quot;, ACTION==&amp;quot;add&amp;quot;, DRIVERS==&amp;quot;?*&amp;quot;, ATTR{address}==&amp;quot;68:05:ca:1a:f5:da&amp;quot;, ATTR{type}==&amp;quot;1&amp;quot;, NAME=&amp;quot;lan1pcie&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Easy qemu commandline passthrough with virt-xml</title><link href="https://crobinso.github.io/2017/03/easy-qemu-commandline-passthrough-with.html" rel="alternate"></link><published>2017-03-24T21:30:00-04:00</published><updated>2017-03-24T21:30:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2017-03-24:/2017/03/easy-qemu-commandline-passthrough-with.html</id><summary type="html">&lt;p&gt;Libvirt has supported &lt;a href="https://libvirt.org/drvqemu.html#qemucommand"&gt;qemu commandline option passthrough&lt;/a&gt; for qemu/kvm VMs for quite a while. The format for it is a bit of a pain though since it requires setting a magic xmlns value at the top of the domain XML. Basically doing it by hand kinda sucks.&lt;/p&gt;
&lt;p&gt;In the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Libvirt has supported &lt;a href="https://libvirt.org/drvqemu.html#qemucommand"&gt;qemu commandline option passthrough&lt;/a&gt; for qemu/kvm VMs for quite a while. The format for it is a bit of a pain though since it requires setting a magic xmlns value at the top of the domain XML. Basically doing it by hand kinda sucks.&lt;/p&gt;
&lt;p&gt;In the recently released &lt;a href="http://blog.wikichoon.com/2017/03/virt-manager-141-released.html"&gt;virt-manager 1.4.1&lt;/a&gt;, we added a virt-install/virt-xml option &lt;strong&gt;--qemu-commandline&lt;/strong&gt; that tweaks option passthrough for new or existing VMs. So for example, if you wanted to add the qemu option string '-device FOO' to an existing VM named &lt;strong&gt;f25&lt;/strong&gt;, you can do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./virt-xml f25 --edit --confirm --qemu-commandline=&amp;quot;-device FOO&amp;quot;

&lt;span class="gd"&gt;--- Original XML&lt;/span&gt;
&lt;span class="gi"&gt;+++ Altered XML&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,4 +1,4 @@&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;lt;domain type=&amp;quot;kvm&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;lt;domain xmlns:qemu=&amp;quot;http://libvirt.org/schemas/domain/qemu/1.0&amp;quot; type=&amp;quot;kvm&amp;quot;&amp;gt;&lt;/span&gt;
   &amp;lt;name&amp;gt;f25&amp;lt;/name&amp;gt;
   &amp;lt;uuid&amp;gt;9b6f1795-c88b-452a-a54c-f8579ddc18dd&amp;lt;/uuid&amp;gt;
   &amp;lt;memory unit=&amp;quot;KiB&amp;quot;&amp;gt;4194304&amp;lt;/memory&amp;gt;
&lt;span class="gu"&gt;@@ -104,4 +104,8 @@&lt;/span&gt;
       &amp;lt;address type=&amp;quot;pci&amp;quot; domain=&amp;quot;0x0000&amp;quot; bus=&amp;quot;0x00&amp;quot; slot=&amp;quot;0x0a&amp;quot; function=&amp;quot;0x0&amp;quot;/&amp;gt;
     &amp;lt;/rng&amp;gt;
   &amp;lt;/devices&amp;gt;
&lt;span class="gi"&gt;+  &amp;lt;qemu:commandline&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;qemu:arg value=&amp;quot;-device&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;qemu:arg value=&amp;quot;foo&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+  &amp;lt;/qemu:commandline&amp;gt;&lt;/span&gt;
 &amp;lt;/domain&amp;gt;

Define &amp;#39;f25&amp;#39; with the changed XML? (y/n):
&lt;/pre&gt;&lt;/div&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>virt-manager 1.4.1 released!</title><link href="https://crobinso.github.io/2017/03/virt-manager-141-released.html" rel="alternate"></link><published>2017-03-08T19:15:00-05:00</published><updated>2017-03-08T19:15:00-05:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2017-03-08:/2017/03/virt-manager-141-released.html</id><summary type="html">&lt;p&gt;I've just released virt-manager 1.4.1. The highlights are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;storage/nodedev event API support (Jovanka Gulicoska)&lt;/li&gt;
&lt;li&gt;UI options for enabling spice GL (Marc-André Lureau)&lt;/li&gt;
&lt;li&gt;Add default virtio-rng /dev/urandom for supported guest OS&lt;/li&gt;
&lt;li&gt;Cloning and rename support for UEFI VMs (Pavel Hrdina)&lt;/li&gt;
&lt;li&gt;libguestfs inspection UI improvements (Pino Toscano)&lt;/li&gt;
&lt;li&gt;virt-install …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;I've just released virt-manager 1.4.1. The highlights are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;storage/nodedev event API support (Jovanka Gulicoska)&lt;/li&gt;
&lt;li&gt;UI options for enabling spice GL (Marc-André Lureau)&lt;/li&gt;
&lt;li&gt;Add default virtio-rng /dev/urandom for supported guest OS&lt;/li&gt;
&lt;li&gt;Cloning and rename support for UEFI VMs (Pavel Hrdina)&lt;/li&gt;
&lt;li&gt;libguestfs inspection UI improvements (Pino Toscano)&lt;/li&gt;
&lt;li&gt;virt-install: Add --qemu-commandline&lt;/li&gt;
&lt;li&gt;virt-install: Add --network vhostuser (Chen Hanxiao)&lt;/li&gt;
&lt;li&gt;virt-install: Add --sysinfo (Charles Arnold)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Plus the usual slew of bug fixes and small improvements.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>UEFI virt roms now in official Fedora repos</title><link href="https://crobinso.github.io/2016/06/uefi-virt-support-now-in-official.html" rel="alternate"></link><published>2016-06-29T13:27:00-04:00</published><updated>2016-06-29T13:27:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2016-06-29:/2016/06/uefi-virt-support-now-in-official.html</id><summary type="html">&lt;p&gt;&lt;a href="https://kparal.wordpress.com/2016/06/27/uefi-for-qemu-now-in-fedora-repositories/"&gt;Kamil&lt;/a&gt; got to it first, but just a note that UEFI roms for x86 and aarch64 virt are now shipped in the standard Fedora repos, where previously the recommended place to grab them was an external nightly repo. Kamil has updated the &lt;a href="https://fedoraproject.org/w/index.php?title=Using_UEFI_with_QEMU"&gt;UEFI+QEMU wiki page&lt;/a&gt; to reflect this change …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://kparal.wordpress.com/2016/06/27/uefi-for-qemu-now-in-fedora-repositories/"&gt;Kamil&lt;/a&gt; got to it first, but just a note that UEFI roms for x86 and aarch64 virt are now shipped in the standard Fedora repos, where previously the recommended place to grab them was an external nightly repo. Kamil has updated the &lt;a href="https://fedoraproject.org/w/index.php?title=Using_UEFI_with_QEMU"&gt;UEFI+QEMU wiki page&lt;/a&gt; to reflect this change.&lt;/p&gt;
&lt;p&gt;On up to date Fedora 23+ these roms will be installed automatically with the relevant qemu packages, and libvirt is properly configured to advertise the rom files to applications, so &lt;a href="http://blog.wikichoon.com/2016/01/uefi-support-in-virt-install-and-virt.html"&gt;enabling this with tools like virt-manager&lt;/a&gt; is available out of the box.&lt;/p&gt;
&lt;p&gt;For the curious, the reason we can now ship these binaries in Fedora is because the problematic EDK2 'FatPkg' code, which had a &lt;a href="https://fedoraproject.org/w/index.php?title=Using_UEFI_with_QEMU&amp;amp;diff=431056&amp;amp;oldid=423634#EDK2_Licensing_Issues"&gt;Fedora incompatible license&lt;/a&gt;, was replaced with an implementation with a less restrictive (and more Fedora friendly) license.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>virt-manager 1.4.0 release</title><link href="https://crobinso.github.io/2016/06/virt-manager-140-release.html" rel="alternate"></link><published>2016-06-18T11:06:00-04:00</published><updated>2016-06-18T11:06:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2016-06-18:/2016/06/virt-manager-140-release.html</id><summary type="html">&lt;p&gt;I've just released virt-manager 1.4.0. Besides the &lt;a href="http://blog.wikichoon.com/2016/05/spice-openglvirgl-acceleration-on.html"&gt;spice GL bits that I previously talked about&lt;/a&gt;, nothing too much exciting in this release except a lot of virt-install/virt-xml command line extensions.&lt;/p&gt;
&lt;p&gt;The changelog highlights:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;virt-manager: spice GL console support (Marc-André Lureau, Cole Robinson)&lt;/li&gt;
&lt;li&gt;Bump gtk and pygobject deps …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;I've just released virt-manager 1.4.0. Besides the &lt;a href="http://blog.wikichoon.com/2016/05/spice-openglvirgl-acceleration-on.html"&gt;spice GL bits that I previously talked about&lt;/a&gt;, nothing too much exciting in this release except a lot of virt-install/virt-xml command line extensions.&lt;/p&gt;
&lt;p&gt;The changelog highlights:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;virt-manager: spice GL console support (Marc-André Lureau, Cole Robinson)&lt;/li&gt;
&lt;li&gt;Bump gtk and pygobject deps to 3.14&lt;/li&gt;
&lt;li&gt;virt-manager: add checkbox to forget keyring password (Pavel Hrdina)&lt;/li&gt;
&lt;li&gt;cli: add --graphics gl= (Marc-André Lureau)&lt;/li&gt;
&lt;li&gt;cli: add --video accel3d= (Marc-André Lureau)&lt;/li&gt;
&lt;li&gt;cli: add --graphics listen=none (Marc-André Lureau)&lt;/li&gt;
&lt;li&gt;cli: add --transient flag (Richard W.M. Jones)&lt;/li&gt;
&lt;li&gt;cli: --features gic= support, and set a default for it (Pavel Hrdina)&lt;/li&gt;
&lt;li&gt;cli: Expose --video heads, ram, vram, vgamem&lt;/li&gt;
&lt;li&gt;cli: add --graphics listen=socket&lt;/li&gt;
&lt;li&gt;cli: add device address.type/address.bus/...&lt;/li&gt;
&lt;li&gt;cli: add --disk seclabelX.model (and .label, .relabel)&lt;/li&gt;
&lt;li&gt;cli: add --cpu cellX.id (and .cpus, and .memory)&lt;/li&gt;
&lt;li&gt;cli: add --network rom_bar= and rom_file=&lt;/li&gt;
&lt;li&gt;cli: add --disk backing_format=&lt;/li&gt;
&lt;/ul&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>check-pylint: mini tool for running pylint anywhere</title><link href="https://crobinso.github.io/2016/06/check-pylint-mini-tool-for-running.html" rel="alternate"></link><published>2016-06-10T08:46:00-04:00</published><updated>2016-06-10T08:46:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2016-06-10:/2016/06/check-pylint-mini-tool-for-running.html</id><summary type="html">&lt;p&gt;pylint and pep8 are indispensable tools for python development IMO. For projects I maintain I've long ago added a 'setup pylint' sub-command to run both commands, and I've documented this as a necessary step in the contributor guidelines.&lt;/p&gt;
&lt;p&gt;But over the years I've accumulated many repos for small bits of …&lt;/p&gt;</summary><content type="html">&lt;p&gt;pylint and pep8 are indispensable tools for python development IMO. For projects I maintain I've long ago added a 'setup pylint' sub-command to run both commands, and I've documented this as a necessary step in the contributor guidelines.&lt;/p&gt;
&lt;p&gt;But over the years I've accumulated many repos for small bits of python code that never have need for a setup.py script, but I still want the convenience of being able to run pylint and pep8 with a single command and a reasonable set of options.&lt;/p&gt;
&lt;p&gt;So, a while back I wrote this tiny '&lt;a href="https://github.com/crobinso/check-pylint"&gt;check-pylint&lt;/a&gt;' script which does exactly that. The main bit it adds is automatically searching the current directory for python scripts and modules and passing them to pylint/pep8. From the README:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Simple helper script that scoops up all python modules and scripts beneath the current directory, and passes them through pylint and pep8. Has a bit of smarts to ignore .git directory, and handle files that don't end in .py&lt;/p&gt;
&lt;p&gt;The point is that you can just fire off 'check-pylint' in any directory containing python code and get a quick report.&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>spice OpenGL/virgl acceleration on Fedora 24</title><link href="https://crobinso.github.io/2016/05/spice-openglvirgl-acceleration-on.html" rel="alternate"></link><published>2016-05-22T10:56:00-04:00</published><updated>2016-05-22T10:56:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2016-05-22:/2016/05/spice-openglvirgl-acceleration-on.html</id><summary type="html">&lt;p&gt;New in Fedora 24 virt is 3D accelerated SPICE graphics, via &lt;a href="https://virgil3d.github.io/"&gt;Virgl&lt;/a&gt;. This is kinda-sorta OpenGL passthrough from the VM up to the host machine. Much of the initial support has been around since qemu 2.5, but it's more generally accessible now that SPICE is in the mix, since …&lt;/p&gt;</summary><content type="html">&lt;p&gt;New in Fedora 24 virt is 3D accelerated SPICE graphics, via &lt;a href="https://virgil3d.github.io/"&gt;Virgl&lt;/a&gt;. This is kinda-sorta OpenGL passthrough from the VM up to the host machine. Much of the initial support has been around since qemu 2.5, but it's more generally accessible now that SPICE is in the mix, since that's the default display type used by virt-manager and gnome-boxes.&lt;/p&gt;
&lt;p&gt;I'll explain below how you can test things on Fedora 24, but first let's cover the hurdles and caveats. This is far from being something that can be turned on by default and there's still serious integration issues to iron out. All of this is regarding usage with libvirt tools.&lt;/p&gt;
&lt;h3&gt;Caveats and known issues&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;This doesn't work with qemu:///system yet, which is what &lt;a href="http://blog.wikichoon.com/2016/01/qemusystem-vs-qemusession.html"&gt;virt-manager uses by default&lt;/a&gt;. Permissions and &lt;a href="http://www.redhat.com/archives/libvir-list/2016-May/msg01435.html"&gt;cgroup access&lt;/a&gt; are problematic at the moment. qemu:///session (the gnome-boxes default) is saved from some of these issues, but it's still affected by...&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1337333"&gt;svirt/selinux issues&lt;/a&gt;. We haven't come up with a plan here yet.&lt;/li&gt;
&lt;li&gt;When enabled, your VM can't be migrated or saved (migrate to disk), either directly or as part of taking a VM snapshot&lt;/li&gt;
&lt;li&gt;This only works if connecting to a VM on your local machine. And once enabled, the VM isn't accessible remotely whatsoever&lt;/li&gt;
&lt;li&gt;virt-manager has some weird rendering behavior that requires &lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1337721"&gt;resizing the window first before you see any display output&lt;/a&gt;. It's fixed upstream, but no fedora build yet. virt-viewer works fine&lt;/li&gt;
&lt;li&gt;virt-manager has some &lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1337721"&gt;weird behavior if trying to run two GL enabled VMs at once&lt;/a&gt;. Patches have been posted upstream for spice-gtk&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Because of these issues, we haven't exposed this as a UI knob in any of the tools yet, to save us some redundant bug reports for the above issues from users who are just clicking a cool sounding check box :) Instead you'll need to explicitly opt in via the command line.&lt;/p&gt;
&lt;h3&gt;Testing it out&lt;/h3&gt;
&lt;p&gt;You'll need the following packages (or later) to test this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;qemu-2.6.0-2.fc24&lt;/li&gt;
&lt;li&gt;libvirt-1.3.3.1-2.fc24&lt;/li&gt;
&lt;li&gt;virt-manager-1.3.2-4.20160520git2204de62d9.fc24&lt;/li&gt;
&lt;li&gt;At least F24 beta on the host&lt;/li&gt;
&lt;li&gt;Fedore 24 beta in the guest. Anything earlier is not going to actually enable the 3D acceleration. I have no idea about the state of other distributions. And to make it abundantly clear this is &lt;strong&gt;linux only&lt;/strong&gt; and likely will be for a long time at least, I don't know if Windows driver support is even on the radar.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once you install a Fedora 24 VM through the standard methods, you can enable spice GL for your VM with these two commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; virt-xml --connect &lt;span class="nv"&gt;$URI&lt;/span&gt; &lt;span class="nv"&gt;$VM_NAME&lt;/span&gt; --confirm --edit --video &lt;span class="nv"&gt;clearxml&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes,model&lt;span class="o"&gt;=&lt;/span&gt;virtio,accel3d&lt;span class="o"&gt;=&lt;/span&gt;yes
&lt;span class="gp"&gt;$&lt;/span&gt; virt-xml --connect &lt;span class="nv"&gt;$URI&lt;/span&gt; &lt;span class="nv"&gt;$VM_NAME&lt;/span&gt; --confirm --edit --graphics &lt;span class="nv"&gt;clearxml&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes,type&lt;span class="o"&gt;=&lt;/span&gt;spice,gl&lt;span class="o"&gt;=&lt;/span&gt;on,listen&lt;span class="o"&gt;=&lt;/span&gt;none
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The first command will switch the graphics device to 'virtio' and enable the 3D acceleration setting. The second command will set up spice to listen locally only, and enable GL. Make sure to fully poweroff the VM afterwards for the settings to take effect. If you want to make the changes manually with '&lt;a href="http://wiki.libvirt.org/page/FAQ#Where_are_VM_config_files_stored.3F_How_do_I_edit_a_VM.27s_XML_config.3F"&gt;virsh edit&lt;/a&gt;', the XML specifics are described in the &lt;a href="https://cgit.freedesktop.org/spice/spice/commit/?id=782c7508e28fdeee786cdcebffd22f772d7f09ec"&gt;spice GL documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once your VM has started up, you can verify that everything is working correctly by checking &lt;code&gt;glxinfo&lt;/code&gt; output in the VM, 'virgl' should appear in the renderer string:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; glxinfo &lt;span class="p"&gt;|&lt;/span&gt; grep virgl
&lt;span class="go"&gt;    Device: virgl (0x1010)&lt;/span&gt;
&lt;span class="go"&gt;OpenGL renderer string: Gallium 0.4 on virgl&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And of course the more fun test of giving supertuxkart a spin :)&lt;/p&gt;
&lt;p&gt;Credit to Dave Airlie, Gerd Hoffman, and Marc-André Lureau for all the great work that got us to this point!&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Tips for querying git tags</title><link href="https://crobinso.github.io/2016/01/tips-for-querying-git-tags.html" rel="alternate"></link><published>2016-01-20T10:00:00-05:00</published><updated>2016-01-20T10:00:00-05:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2016-01-20:/2016/01/tips-for-querying-git-tags.html</id><summary type="html">&lt;p&gt;With package maintenance, bug triage, and email support, I often need to look at a project's git tags to know about the latest releases, when they were released, and what releases contain certain features. Here's a couple workflow tips that make my life easier.&lt;/p&gt;
&lt;h3&gt;Better git tag listing&lt;/h3&gt;
&lt;p&gt;Based on …&lt;/p&gt;</summary><content type="html">&lt;p&gt;With package maintenance, bug triage, and email support, I often need to look at a project's git tags to know about the latest releases, when they were released, and what releases contain certain features. Here's a couple workflow tips that make my life easier.&lt;/p&gt;
&lt;h3&gt;Better git tag listing&lt;/h3&gt;
&lt;p&gt;Based on Peter Hutterer's &lt;a href="http://who-t.blogspot.com/2012/06/git-branch-info.html"&gt;'git bi'&lt;/a&gt; alias for improved branch listing (which is great and highly recommended), I made one for improved tags output that I mapped as 'git tags'. Output looks like:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://1.bp.blogspot.com/-S1JscfM_bNg/U8WjuPH4hYI/AAAAAAAAAEc/6oZXuvPiHh8/s1600/Screenshot+from+2014-07-15+17:56:45.png"&gt;&lt;img alt="" height="109" src="http://1.bp.blogspot.com/-S1JscfM_bNg/U8WjuPH4hYI/AAAAAAAAAEc/6oZXuvPiHh8/s1600/Screenshot+from+2014-07-15+17:56:45.png" width="400"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Shows tag name, commit message, commit ID, and date, all colorized. Commit message is redundant for many projects that tag the release commit, but it's interesting in some cases.&lt;/li&gt;
&lt;li&gt;Tags are listed by date rather than alphabetically. Some projects change tag string formats, or versioning schemes, that then don't sort correctly when listed alphabetically. Sorting by date makes it easy to see the latest tag. Often I just want to know what the latest tag or the latest stable release is, this makes it easy.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The alias code is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[alias]&lt;/span&gt;
   &lt;span class="na"&gt;tags&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;!sh -c &amp;#39; \&lt;/span&gt;
&lt;span class="na"&gt;git for-each-ref --format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;\&amp;quot;%(refname:short)\&amp;quot; refs/tags | \&lt;/span&gt;
&lt;span class="na"&gt;while read tag; do \&lt;/span&gt;
   &lt;span class="na"&gt;git --no-pager log -1 --format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;format:\&amp;quot;$tag %at\&amp;quot; $tag; echo; \&lt;/span&gt;
&lt;span class="na"&gt;done | \&lt;/span&gt;
&lt;span class="na"&gt;sort -k 2 | cut -f 1 --delimiter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;\&amp;quot; \&amp;quot; | \&lt;/span&gt;
&lt;span class="na"&gt;while read tag; do \&lt;/span&gt;
   &lt;span class="na"&gt;fmt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;\&amp;quot;%Cred$tag:%Cblue %s %Cgreen%h%Creset (%ai)\&amp;quot;; \&lt;/span&gt;
&lt;span class="s"&gt;   git --no-pager log -1 --format=format:\&amp;quot;$fmt\&amp;quot; $tag; echo; \&lt;/span&gt;
&lt;span class="na"&gt;done&amp;#39;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Find the first tag that contains a commit&lt;/h3&gt;
&lt;p&gt;This seems to come up quite a bit for me. An example is &lt;a href="http://www.redhat.com/archives/libvir-list/2014-July/msg00832.html"&gt;here&lt;/a&gt;; a user was asking about a virt-install feature, and I wanted to tell them what version it appeared in. I grepped &lt;code&gt;git log&lt;/code&gt;, found the commit, then ran:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; git describe --contains 87a611b5470d9b86bf57a71ce111fa1d41d8e2cd
&lt;span class="go"&gt;v1.0.0~201&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That shows me that v1.0.0 was the first release with the feature they wanted, just take whatever is to the left of the tilde.&lt;/p&gt;
&lt;p&gt;This often comes in handy with backporting as well: a developer will point me at a bug fix commit ID, I run git describe to see what upstream version it was released in, so I know what fedora package versions are lacking the fix.&lt;/p&gt;
&lt;p&gt;Another tip here is to use the --match option to only search tags matching a particular glob. I've used this to filter out matching against a maintenance or bugfix release branch, when I only wanted to search major version releases.&lt;/p&gt;
&lt;h3&gt;Don't pull tags from certain remotes&lt;/h3&gt;
&lt;p&gt;For certain repos like qemu.git, I add a lot of git remotes pointing to individual developer's trees for occasional patch testing. However if trees have lots of non-upstream tags, like for use with pull-requests, they can interfere with my workflow for backporting patches. Use the --no-tags option for this: &lt;code&gt;git remote add --no-tags $repo&lt;/code&gt;&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Using CPU host-passthrough with virt-manager</title><link href="https://crobinso.github.io/2016/01/using-cpu-host-passthrough-with-virt.html" rel="alternate"></link><published>2016-01-15T10:00:00-05:00</published><updated>2016-01-15T10:00:00-05:00</updated><author><name>Cole Robinson</name></author><id>tag:crobinso.github.io,2016-01-15:/2016/01/using-cpu-host-passthrough-with-virt.html</id><summary type="html">&lt;p&gt;I described virt-manager's CPU model default in &lt;a href="http://blog.wikichoon.com/2014/03/virt-manager-improved-cpu-model-default.html"&gt;this post&lt;/a&gt;. In that post I explained the difficulties of using either of the libvirt options for mirroring the host CPU: &lt;strong&gt;mode=host-model&lt;/strong&gt; still has operational issues, and &lt;strong&gt;mode=host-passthrough&lt;/strong&gt; isn't recommended for use with libvirt over supportability concerns.&lt;/p&gt;
&lt;p&gt;Unfortunately since writing that …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I described virt-manager's CPU model default in &lt;a href="http://blog.wikichoon.com/2014/03/virt-manager-improved-cpu-model-default.html"&gt;this post&lt;/a&gt;. In that post I explained the difficulties of using either of the libvirt options for mirroring the host CPU: &lt;strong&gt;mode=host-model&lt;/strong&gt; still has operational issues, and &lt;strong&gt;mode=host-passthrough&lt;/strong&gt; isn't recommended for use with libvirt over supportability concerns.&lt;/p&gt;
&lt;p&gt;Unfortunately since writing that post the situation hasn't improved any, and since host-passthrough is the only reliably way to expose the full capabilities of the host CPU to the VM, users regularly want to enable it. This is particularly apparent if trying to do nested virt, which often doesn't work on Intel CPUs unless host-passthrough is used.&lt;/p&gt;
&lt;p&gt;However we don't explicitly expose this option in virt-manager since it's not generally recommended for libvirt usage. You &lt;em&gt;can&lt;/em&gt; however still enable it in virt-manager:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Navigate to VM Details-&gt;CPU&lt;/li&gt;
&lt;li&gt;Enter &lt;strong&gt;host-passthrough&lt;/strong&gt; in the CPU model field&lt;/li&gt;
&lt;li&gt;Click Apply&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://3.bp.blogspot.com/-NBBPSoa4T6E/Vohv9ZI01YI/AAAAAAAAA1U/_-1K9y7PtU8/s1600/Screenshot%2Bfrom%2B2016-01-02%2B19-48-35.png"&gt;&lt;img alt="" height="365" src="https://3.bp.blogspot.com/-NBBPSoa4T6E/Vohv9ZI01YI/AAAAAAAAA1U/_-1K9y7PtU8/s400/Screenshot%2Bfrom%2B2016-01-02%2B19-48-35.png" width="400"&gt;&lt;/a&gt;&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry></feed>